<!DOCTYPE html>
<html>

  <head>

  <title> Medias Test </title>
    <link rel="stylesheet" href="test1.css">
    

  <script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <script  type="text/javascript" src="https://apis.google.com/js/client.js?onload=init"></script>
    <script type="text/javascript"  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBZGvhqAz0grBbzAbGdI_htb72q8uA_KlQ" >
    </script>
  </head>

  <body>

    <div class="nav">
      <div class="container">
      </div>
    </div>

    <div class="content">
      <div class="country">
        <div class="countryName">
        </div>
        <div class="countryflags">
          <div id="peruButton">
            <img src="Peru.png" alt="Peru" height="42" width="54">
          </div>
          <div id="Bolivia">
            <img src="Bolivia.png" alt="Bolivia" height="42" width="54">
          </div>
          <div id="Chile">
            <img src="Chile.png" alt="Chile" height="42" width ="54">
          </div>
          <div id="Argentina">
            <img src="Argentina.png" alt="Argentina" height="42" width="54">
          </div>
        </div>
      </div>
		  <div class="blog" >
	    </div>
	  </div>



    <script>
     
    function Country(name, startDate, endDate){
      this.name = name;
      this.startDate = startDate;
      this.endDate = endDate;
      this.blogArray = [];
    };

    function Blog(content, location, title){
      this.content = content;
      this.location = location;
      this.title = title;
    };

    var argentina = new Country('Argentina', '2014-12-08T11:00:00', '2014-12-18T11:00:00' );
    var bolivia = new Country('Bolivia',  '2014-11-12T11:00:00', '2014-12-08T11:00:00' );
    var chile = new Country('Country','2014-09-08T11:00:00', '2014-11-12T11:00:00');

    
    $.ajax({
      type: "GET",
      url: "https://www.googleapis.com/blogger/v3/blogs/2096447250273390307/posts?fetchBodies=true&fields=items(content%2Clocation(lat%2Clng%2Cname)%2Cpublished%2Ctitle)&key=AIzaSyBZGvhqAz0grBbzAbGdI_htb72q8uA_KlQ",
      success: function(response) {
        //populate the country array
        for(var b = 0; b <response.items.length; b++){
          if((response.items[b].published > argentina.startDate) && (response.items[b].published < argentina.endDate)){
            $('.blog').append("<h2> A" + response.items[b].published+"<h2>");
            argentina.blogArray[argentina.blogArray.length] = new Blog(response.items[b].content, response.items[b].location,response.items[b].title);
          }
          else if((response.items[b].published > chile.startDate) && (response.items[b].published < chile.endDate)){
            $('.blog').append("<h2> C" + response.items[b].published+"<h2>");
            chile.blogArray[chile.blogArray.length] = new Blog(response.items[b].content, response.items[b].location,response.items[b].title);
          }
          else if((response.items[b].published > bolivia.startDate) && (response.items[b].published < bolivia.endDate)){
            $('.blog').append("<h2> B" + response.items[b].published+"<h2>");
            bolivia.blogArray[bolivia.blogArray.length] = new Blog(response.items[b].content, response.items[b].location,response.items[b].title);
          }
        }
        

      
        for (var i = 0; i < response.items.length; i++) {
          //open a div for blog unique with the location in the response array
          $('<div></div>').addClass('posts'+i).appendTo('.blog');

          //add a div for the post content
          $('<div></div>').addClass('postsText').attr('id','postsText'+i).appendTo('.posts'+i);

          //Add blog text and titles
          $('#postsText'+i).append("<h2>" + response.items[i].title + "</h2>");
          $('#postsText'+i).append(response.items[i].content);



          for (lat in response.items[i].location) {

            //add a div for the post map
            $('<div></div>').addClass('postsMap').attr('id','postsMap'+i).appendTo('.posts'+i);

            var mapOptions = {
                center: new google.maps.LatLng(response.items[i].location.lat,response.items[i].location.lng),
                zoom: 6,
                disableDefaultUI: true
              };
              var blogMap = new google.maps.Map($('#postsMap'+i)[0], mapOptions);
              $('#postsMap'+i).css('height', $('#postsText'+i).height());

              var myLatlng = new google.maps.LatLng(response.items[i].location.lat,response.items[i].location.lng);
              var marker = new google.maps.Marker({
                position: myLatlng,
                map: blogMap,
                title: response.items[i].location.name
              })
          }
        }

      }
    });


    </script>

  </body>
</html>